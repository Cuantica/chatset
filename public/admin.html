<!doctype html>
<html>
  <head>
    <title>Chatset</title>
    <link rel="stylesheet" type="text/css" href="css/styles.css">


    <script src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous"></script>
    <link href="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
    <script src="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
    <link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">

  </head>
  <body>
    
        
        <!--div class="container-chat ">
            <ul id="messages"></ul>
            <form action="" id="form-message-send">
                <input id="message-input" autocomplete="off" /><button>Enviar</button>
            </form>
        </div-->
    

<div class="app-stream">
    <div class="container">    
        <div class="row header-top">
            <div class="col-lg-3">
                <div class="btn-panel btn-panel-conversation">
                    <a href=""  class="btn  col-lg-6 send-message-btn " role="button"><i class="fa fa-search"></i> Search</a>
                    <a href="" class="btn  col-lg-6  send-message-btn pull-right" role="button"><i class="fa fa-plus"></i> New Message</a>
                </div>
            </div>
    
            <div class="col-lg-offset-1 col-lg-7">
                <div class="btn-panel btn-panel-msg">
                    <a href="" id="session-start"class="btn  col-lg-3  send-message-btn pull-right" role="button"><i class="fa fa-gears"></i> Settings</a>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="conversation-wrap col-lg-3">
                <ul id="user-list"></ul>
            </div>
            
            <!-- chat conversation detail -->
            <div class="message-wrap offset-lg-4 col-lg-8 " id="container-chat-adm">
                <div class="msg-wrap">
                    <!--div class="alert alert-info msg-date">
                        <strong>Today</strong>
                    </div-->
                    <ul id="messages"></ul>
                    <!--div class="media msg">
                        <a class="pull-left" href="#">
                            <img class="media-object" data-src="holder.js/64x64" alt="64x64" style="width: 32px; height: 32px;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAACqUlEQVR4Xu2Y60tiURTFl48STFJMwkQjUTDtixq+Av93P6iBJFTgg1JL8QWBGT4QfDX7gDIyNE3nEBO6D0Rh9+5z9rprr19dTa/XW2KHl4YFYAfwCHAG7HAGgkOQKcAUYAowBZgCO6wAY5AxyBhkDDIGdxgC/M8QY5AxyBhkDDIGGYM7rIAyBgeDAYrFIkajEYxGIwKBAA4PDzckpd+322243W54PJ5P5f6Omh9tqiTAfD5HNpuFVqvFyckJms0m9vf3EY/H1/u9vb0hn89jsVj8kwDfUfNviisJ8PLygru7O4TDYVgsFtDh9Xo9NBrNes9cLgeTybThgKenJ1SrVXGf1WoVDup2u4jFYhiPx1I1P7XVBxcoCVCr1UBfTqcTrVYLe3t7OD8/x/HxsdiOPqNGo9Eo0un02gHkBhJmuVzC7/fj5uYGXq8XZ2dnop5Mzf8iwMPDAxqNBmw2GxwOBx4fHzGdTpFMJkVzNB7UGAmSSqU2RoDmnETQ6XQiOyKRiHCOSk0ZEZQcUKlU8Pz8LA5vNptRr9eFCJQBFHq//szG5eWlGA1ywOnpqQhBapoWPfl+vw+fzweXyyU+U635VRGUBOh0OigUCggGg8IFK/teXV3h/v4ew+Hwj/OQU4gUq/w4ODgQrkkkEmKEVGp+tXm6XkkAOngmk4HBYBAjQA6gEKRmyOL05GnR99vbW9jtdjEGdP319bUIR8oA+pnG5OLiQoghU5OElFlKAtCGr6+vKJfLmEwm64aosd/XbDbbyIBSqSSeNKU+HXzlnFAohKOjI6maMs0rO0B20590n7IDflIzMmdhAfiNEL8R4jdC/EZIJj235R6mAFOAKcAUYApsS6LL9MEUYAowBZgCTAGZ9NyWe5gCTAGmAFOAKbAtiS7TB1Ng1ynwDkxRe58vH3FfAAAAAElFTkSuQmCC">
                        </a>
                        <div class="media-body">
                            <small class="pull-right time"><i class="fa fa-clock-o"></i> 12:10am</small>
    
                            <h5 class="media-heading">Naimish Sakhpara</h5>
                            <small class="col-lg-10">Arnab Goswami: "Some people close to Congress Party and close to the government had a #secret #meeting in a farmhouse in Maharashtra in which Anna Hazare send some representatives and they had a meeting in the discussed how to go about this all fast and how eventually this will end."</small>
                        </div>
                    </div-->
                </div>
    
                <div class="send-wrap ">
                    <form action="" id="form-message-send">
                        <textarea class="form-control send-message" rows="3" 
                            placeholder="Escriba su mensaje aquÃ­"
                            id="message-input" ></textarea>
                        <button>Enviar</button>
                    </form>
                </div>


                <!--div class="btn-panel">
                    <a href="" class=" col-lg-3 btn   send-message-btn " role="button"><i class="fa fa-cloud-upload"></i> Add Files</a>
                    <a href="" class=" col-lg-4 text-right btn   send-message-btn pull-right" role="button"><i class="fa fa-plus"></i> Send Message</a>
                </div-->
            </div>
        </div>
    </div>
</div>

    <!-- Javascript loading -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.4/socket.io.js"></script>
    <script>
        // Ready jQuery
        var socket = io();

        $('#form-message-send').submit(function(){
            let message_val = $('#message-input').val();
            
            if ('' != message_val.trim('')){
                socket.emit('chat message', message_val);
                $('#message-input').val('');     
            }
            else
                console.log('Error');
            
            return false;
        });

        // modificar
        socket.on('chat message', function(message){
            //$('#messages').prepend($('<li>').html(message));
            //Actualiza el usuario, y emite un sonido
        });


        // Probamos si inicia session simulando con un boton
        $('#session-start').on("click", function(ev){
            ev.preventDefault();
            socket.emit('user-admin-login');
        });

        // Se agrega usuario a la lista
        socket.on('user-added', function(user){
            let vhtml = `<div class="media conversation" data-user="${user._id}">
                            <div class="media-body">
                                <h3 class="media-heading">${user.user_name}</h3>
                            </div>
                        </div>`;
            $('#user-list').prepend($('<li>').html(vhtml));
        });

        

        // -- Dom Event --
        $("#user-list li").delegate("click",function(){
            console.log($(this).attr("data-user"));
        });


        // Formulario para responder chats
        $("#form-message-send").on('submit', function(ev){
            ev.preventDefault();
            
            let msg = $(this).children("#message-input").val();
            console.log(msg);
            //socket.emit('chat message', msg);
        })
        
    </script>
    
  </body>
</html>





